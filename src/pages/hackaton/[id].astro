---
import LayoutHackatones from '../../layouts/LayoutHackatones.astro';
import ModalParticipar from '../../components/react/ModalParticipar';
import Navegacion from '../../components/General/Navegacion.astro';
import Footer from '../../components/Footer.astro';

export async function getStaticPaths() {
    // Obtener todos los IDs de hackatones
    const res = await fetch('http://localhost:4321/api/allhackatones');
    const hackatones = await res.json();

    return hackatones.map((hackaton: any) => ({
        params: { id: hackaton.id.toString() },
    }));
}

// Obtener el ID de los parámetros de la ruta
const { id } = Astro.params;

// Fetch para obtener los datos específicos del hackaton
const response = await fetch('http://localhost:4321/api/idhackaton', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify({ idHack: id }), // Enviamos el ID correctamente
});

if (!response.ok) {
    return new Response(null, {
        status: 404,
        statusText: 'Not Found',
    });
}

const data = await response.json();

// Como es un array con un solo objeto:
const hackaton = data.hackaton?.[0];

if (!hackaton) {
    console.error('Hackatón no encontrado');
}

const { nombre, descripcion, fecha, lenguajes, imagen, end_date, instrucciones, premios, sitio } = hackaton; // Obtenemos los datos del hackaton

console.log(hackaton);
---

<LayoutHackatones title={`Hackatón: ${nombre}`}>
    <div class="flex justify-between items-center w-full flex-col min-h-screen">
        <Navegacion />
        <section class="flex flex-col gap-6 text-white max-w-[1200px] mx-auto z-50 my-5">
            <div class="flex flex-col gap-4 w-full bg-black z-50 p-8 rounded-3xl">
                <section class="flex gap-6">
                    <div class="flex-1">
                        <img
                            src={imagen}
                            alt={`Hackatón ${nombre}`}
                            class="w-full max-w-md object-contain rounded-xl"
                        />
                    </div>
                    <div class="flex-2 flex flex-col gap-6 justify-center">
                        <h1
                            class="text-7xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-300 via-pink-400 to-secondary"
                        >
                            {nombre}
                        </h1>
                        <p class="text-2xl">
                            📅 Fecha: Del{' '}
                            {
                                new Date(fecha).toLocaleDateString('es-ES', {
                                    day: 'numeric',
                                    month: 'long',
                                    year: 'numeric',
                                })
                            }{' '}
                            al {' '}
                            {
                                new Date(end_date).toLocaleDateString('es-ES', {
                                    day: 'numeric',
                                    month: 'long',
                                    year: 'numeric',
                                })
                            }}
                        </p>
                        <p class="text-2xl">🧠 Lenguajes: {lenguajes}</p>

                        <ModalParticipar client:only="react" />
                    </div>
                </section>

                <section class="w-full mt-6 flex gap-5 flex-col">
                    <p class="text-3xl text-blue-300">Descripción del hackaton</p>
                    <p class="text-white">{descripcion}</p>
                </section>

                <section class="w-full mt-6 flex gap-5 flex-col">
                    <p class="text-3xl text-blue-300">Instrucciones</p>
                    <p style={{ whiteSpace: 'pre-line' }}>{instrucciones}</p>
                </section>

                <section class="w-full mt-6 flex gap-5 flex-col">
                    <p class="text-3xl text-blue-300">Para mas informacion del patrocinador</p>
                    <a
                        href={sitio}
                        target="_blank"
                        class="text-white hover:underline transition-colors hover:text-blue-400 text-2xl"
                        >Link: {sitio}</a
                    >
                </section>

                <section class="w-full mt-6 flex gap-5 flex-col">
                    <p class="text-3xl text-blue-300">Premios</p>
                    <p style={{ whiteSpace: 'pre-line' }} class="text-white text-2xl font-bold">
                        {
                            premios
                                .split(',')
                                .map((premio: string, i: number) => `🏆 Premio ${i + 1}:  ${premio}`)
                                .join('\n')
                        }
                    </p>
                </section>
            </div>
        </section>
        <Footer />
    </div>
</LayoutHackatones>
